<!-- Path: GeneralWebApi/Frontend/general-frontend/src/app/features/employees/employee-detail/employee-detail.component.html -->
<app-base-modal
  [isOpen]="isOpen && employee !== null"
  [title]="getModalTitle()"
  [icon]="mode === 'edit' ? 'edit' : 'person'"
  [config]="{
    size: 'large',
    closable: true,
    backdrop: true,
    keyboard: true,
    animation: true,
    centered: true,
    scrollable: true
  }"
  (closeEvent)="onClose()"
  (backdropClick)="onBackdropClick()"
>
  <div class="employee-detail-content" *ngIf="employee">
    <!-- Employee Header Section -->
    <div class="employee-detail-header">
      <div class="avatar-section">
        <div class="avatar-wrapper">
      <app-base-avatar
            [src]="avatarPreview() || employee.avatar || ''"
        [fallbackText]="getInitials()"
        [alt]="getFullName()"
        size="large"
        shape="circle"
      ></app-base-avatar>
          @if (mode === 'edit') {
            <div class="avatar-overlay">
              <input
                type="file"
                id="avatar-upload"
                accept="image/*"
                (change)="onAvatarFileSelect($event)"
                class="avatar-input"
                [disabled]="avatarUploading()"
              />
              <label for="avatar-upload" class="avatar-upload-button" [class.uploading]="avatarUploading()">
                @if (avatarUploading()) {
                  <span class="material-icons">hourglass_empty</span>
                } @else {
                  <span class="material-icons">camera_alt</span>
                }
              </label>
              @if (selectedAvatarFile || avatarPreview()) {
                <button
                  type="button"
                  class="avatar-remove-button"
                  (click)="onRemoveAvatar()"
                  [disabled]="avatarUploading()"
                  [attr.aria-label]="'Remove avatar' | translate"
                >
                  <span class="material-icons">close</span>
                </button>
              }
            </div>
          }
        </div>
      </div>
      <div class="employee-header-info">
        <h2 class="employee-name">{{ getFullName() }}</h2>
        <div class="employee-badges">
          <app-base-badge
            [text]="employee.status | titlecase"
            [variant]="getStatusVariant()"
            size="small"
          ></app-base-badge>
          <span class="employee-id" *ngIf="employee.employeeNumber">
            {{ 'employees.detail.id' | translate }}: {{ employee.employeeNumber }}
          </span>
        </div>
        <div class="employee-actions">
          <app-base-button
            [text]="'employees.hierarchy.viewHierarchy' | translate"
            variant="outline"
            size="small"
            (buttonClick)="onViewHierarchy()"
            icon="people"
          ></app-base-button>
        </div>
      </div>
    </div>

    <!-- Employee Edit Form -->
    <div class="employee-form-container">
      <app-base-form
        [config]="formConfig"
        [formData]="formData"
        [loading]="loading()"
        [fieldLoading]="fieldLoading()"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onFormCancel()"
        (fieldDropdownOpen)="onFieldDropdownOpen($event.key)"
      ></app-base-form>
    </div>
  </div>
</app-base-modal>

<!-- Employee Hierarchy Modal -->
@if (showHierarchyModal() && employee) {
  <app-base-modal
    [isOpen]="showHierarchyModal()"
    [title]="'employees.hierarchy.title' | translate"
    [config]="{
      size: 'large',
      closable: true,
      backdrop: true,
      keyboard: true,
      animation: true,
      centered: true,
      scrollable: true
    }"
    (closeEvent)="onCloseHierarchyModal()"
  >
    <app-employee-hierarchy
      [employeeId]="employee.id"
      [employeeName]="getFullNameForHierarchy()"
    ></app-employee-hierarchy>
  </app-base-modal>
}

