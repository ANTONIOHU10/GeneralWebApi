// Path: GeneralWebApi/Frontend/general-frontend/src/app/features/system-monitor/components/database-health-card/database-health-card.component.scss
@use '../../../../../styles/core/variable' as *;
@use '../../../../../styles/core/mixin' as *;

.database-health-card {
  background: var(--background-primary);
  border-radius: $border-radius-xl;
  border: 1px solid var(--border-secondary);
  overflow: hidden;
  transition: box-shadow $duration-200 $ease-out, transform $duration-200 $ease-out;

  &:hover {
    box-shadow: $shadow-lg;
    transform: translateY(-2px);
  }

  // Card Header
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: $spacing-4 $spacing-5;
    background: linear-gradient(135deg, rgba($success-500, 0.08) 0%, rgba($success-500, 0.02) 100%);
    border-bottom: 1px solid var(--border-secondary);

    .header-left {
      display: flex;
      align-items: center;
      gap: $spacing-3;

      .icon-wrapper {
        width: 48px;
        height: 48px;
        border-radius: $border-radius-lg;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: $shadow-md;

        &.database {
          background: linear-gradient(135deg, $success-500 0%, $success-700 100%);
        }

        .material-icons {
          color: white;
          font-size: 1.5rem;
        }
      }

      .header-info {
        h3 {
          margin: 0;
          font-size: $font-size-lg;
          font-weight: $font-weight-bold;
          color: var(--text-primary);
        }

        .subtitle {
          font-size: $font-size-xs;
          color: var(--text-tertiary);
          margin-top: 2px;
        }
      }
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: $spacing-2;

      .refresh-btn {
        width: 32px;
        height: 32px;
        border-radius: $border-radius-full;
        border: 1px solid var(--border-secondary);
        background: var(--background-secondary);
        color: var(--text-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all $duration-150 $ease-out;

        &:hover:not(:disabled) {
          background: var(--background-tertiary);
          color: var(--text-primary);
          border-color: var(--border-primary);
        }

        &:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .material-icons {
          font-size: 1.125rem;

          &.spinning {
            animation: spin 1s linear infinite;
          }
        }
      }
    }
  }

  // Metric Section
  .metric-section {
    padding: $spacing-4 $spacing-5;
    border-bottom: 1px solid var(--border-secondary);

    &:last-child {
      border-bottom: none;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: $spacing-2;
      font-size: $font-size-sm;
      font-weight: $font-weight-semibold;
      color: var(--text-secondary);
      margin-bottom: $spacing-4;
      text-transform: uppercase;
      letter-spacing: 0.5px;

      .material-icons {
        font-size: 1rem;
        color: var(--text-tertiary);
      }

      &.clickable {
        cursor: pointer;
        padding: $spacing-2;
        margin: -$spacing-2;
        margin-bottom: $spacing-2;
        border-radius: $border-radius-base;
        border: none;
        background: transparent;
        width: calc(100% + #{$spacing-4});
        transition: background $duration-150 $ease-out;

        &:hover {
          background: var(--background-secondary);
        }

        .expand-icon {
          margin-left: auto;
          transition: transform $duration-200 $ease-out;

          &.expanded {
            transform: rotate(180deg);
          }
        }
      }
    }
  }

  // Metrics Grid
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: $spacing-3;

    .metric-item {
      display: flex;
      align-items: flex-start;
      gap: $spacing-3;
      padding: $spacing-3;
      border-radius: $border-radius-lg;
      background: var(--background-secondary);
      border: 1px solid var(--border-secondary);
      transition: border-color $duration-150 $ease-out;

      &.excellent {
        border-left: 3px solid $success-500;
        .metric-status { color: $success-600; }
      }
      &.good {
        border-left: 3px solid $success-400;
        .metric-status { color: $success-500; }
      }
      &.warning {
        border-left: 3px solid $warning-500;
        .metric-status { color: $warning-600; }
      }
      &.poor {
        border-left: 3px solid $error-500;
        .metric-status { color: $error-600; }
      }
      &.neutral {
        border-left: 3px solid $info-500;
        .metric-status { color: $info-600; }
      }

      .metric-icon {
        width: 36px;
        height: 36px;
        border-radius: $border-radius-md;
        background: var(--background-tertiary);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;

        .material-icons {
          font-size: 1.125rem;
          color: var(--text-secondary);
        }
      }

      .metric-content {
        display: flex;
        flex-direction: column;
        min-width: 0;

        .metric-value {
          font-size: $font-size-xl;
          font-weight: $font-weight-bold;
          color: var(--text-primary);
          line-height: 1.2;

          .metric-unit {
            font-size: $font-size-sm;
            font-weight: $font-weight-normal;
            color: var(--text-tertiary);
            margin-left: 2px;
          }
        }

        .metric-label {
          font-size: $font-size-xs;
          color: var(--text-tertiary);
          margin-top: 2px;
        }

        .metric-status {
          font-size: $font-size-xs;
          font-weight: $font-weight-medium;
          margin-top: 4px;
        }
      }
    }
  }

  // Storage Bar
  .storage-bar-container {
    margin-bottom: $spacing-4;

    .storage-bar {
      position: relative;
      height: 24px;
      background: var(--background-tertiary);
      border-radius: $border-radius-full;
      overflow: hidden;

      .storage-bar-fill {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(90deg, $success-400 0%, $success-600 100%);
        border-radius: $border-radius-full;
        transition: width $duration-500 $ease-out;
      }

      .storage-bar-label {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 $spacing-3;
        font-size: $font-size-xs;
        font-weight: $font-weight-medium;
        color: var(--text-primary);
        mix-blend-mode: difference;
      }
    }

    .storage-legend {
      display: flex;
      gap: $spacing-4;
      margin-top: $spacing-2;

      .legend-item {
        display: flex;
        align-items: center;
        gap: $spacing-1;
        font-size: $font-size-xs;
        color: var(--text-secondary);

        .legend-dot {
          width: 8px;
          height: 8px;
          border-radius: $border-radius-full;

          &.data {
            background: $success-500;
          }
          &.log {
            background: var(--text-tertiary);
          }
        }
      }
    }
  }

  // Stats Grid
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: $spacing-2;

    .stat-item {
      text-align: center;
      padding: $spacing-3;
      background: var(--background-secondary);
      border-radius: $border-radius-md;
      border: 1px solid var(--border-secondary);

      .stat-value {
        display: block;
        font-size: $font-size-lg;
        font-weight: $font-weight-bold;
        color: var(--text-primary);
      }

      .stat-label {
        display: block;
        font-size: $font-size-xs;
        color: var(--text-tertiary);
        margin-top: 2px;
      }
    }
  }

  // Tables Section
  .tables-section {
    .tables-container {
      max-height: 0;
      overflow: hidden;
      transition: max-height $duration-300 $ease-out;

      &.expanded {
        max-height: 500px;
      }
    }

    .tables-list {
      display: flex;
      flex-direction: column;
      gap: $spacing-2;

      .table-row {
        display: flex;
        align-items: center;
        gap: $spacing-3;
        padding: $spacing-2 $spacing-3;
        background: var(--background-secondary);
        border-radius: $border-radius-md;
        border: 1px solid var(--border-secondary);
        animation: slideInUp $duration-200 $ease-out backwards;

        .table-rank {
          width: 24px;
          height: 24px;
          border-radius: $border-radius-full;
          background: var(--background-tertiary);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: $font-size-xs;
          font-weight: $font-weight-bold;
          color: var(--text-secondary);
          flex-shrink: 0;
        }

        .table-info {
          flex: 1;
          min-width: 0;

          .table-name {
            font-size: $font-size-sm;
            font-weight: $font-weight-medium;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .table-bar-container {
            height: 4px;
            background: var(--background-tertiary);
            border-radius: $border-radius-full;
            margin-top: 4px;
            overflow: hidden;

            .table-bar {
              height: 100%;
              background: linear-gradient(90deg, $primary-400 0%, $primary-600 100%);
              border-radius: $border-radius-full;
              transition: width $duration-300 $ease-out;
            }
          }
        }

        .table-stats {
          display: flex;
          gap: $spacing-3;
          flex-shrink: 0;

          .table-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: $font-size-xs;
            color: var(--text-secondary);

            .material-icons {
              font-size: 0.875rem;
              color: var(--text-tertiary);
            }
          }
        }
      }
    }
  }

  // Error Banner
  .error-banner {
    display: flex;
    align-items: center;
    gap: $spacing-2;
    padding: $spacing-3 $spacing-5;
    background: rgba($error-500, 0.08);
    border-top: 1px solid rgba($error-500, 0.2);
    color: $error-600;
    font-size: $font-size-sm;

    .material-icons {
      font-size: 1.125rem;
    }
  }

  // Loading State
  .loading-state {
    padding: $spacing-5;

    .loading-shimmer {
      height: 20px;
      background: linear-gradient(90deg, var(--background-secondary) 25%, var(--background-tertiary) 50%, var(--background-secondary) 75%);
      background-size: 200% 100%;
      border-radius: $border-radius-base;
      margin-bottom: $spacing-3;
      animation: shimmer 1.5s infinite;

      &.short {
        width: 60%;
      }
    }
  }
}

// Animations
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

// Responsive
@include mobile-only {
  .database-health-card {
    .metrics-grid {
      grid-template-columns: 1fr;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }

    .tables-section .table-row {
      flex-wrap: wrap;

      .table-info {
        flex: 1 0 calc(100% - 40px);
      }

      .table-stats {
        flex: 1 0 100%;
        margin-top: $spacing-2;
        padding-left: calc(24px + #{$spacing-3});
      }
    }
  }
}

