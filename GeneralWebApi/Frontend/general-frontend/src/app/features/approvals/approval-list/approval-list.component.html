<!-- Path: GeneralWebApi/Frontend/general-frontend/src/app/features/approvals/approval-list/approval-list.component.html -->
<app-base-private-page-container
  [title]="'approvals.title' | translate"
  [subtitle]="'approvals.subtitle' | translate"
  icon="approval"
  [showTabs]="false"
  [showSearch]="false"
>
  <!-- Filter -->
  <app-base-card [title]="'approvals.filter' | translate" [icon]="'filter_list'" [variant]="'elevated'">
    <div class="filter-buttons">
      <button
        *ngFor="let filter of filterOptions"
        [class.active]="activeFilter() === filter"
        (click)="onFilterChange(filter)"
        class="filter-button"
        [class.active]="activeFilter() === filter"
      >
        {{ getFilterLabel(filter) }}
        <span *ngIf="filter !== 'all'">({{ getFilterCount(filter) }})</span>
      </button>
    </div>
  </app-base-card>

  <!-- Statistics -->
  <div class="statistics-grid" *ngIf="approvals().length > 0">
    <app-base-card [variant]="'elevated'">
      <div class="stat-card">
        <div class="stat-icon warning">
          <span class="material-icons">pending_actions</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ pendingCount() }}</div>
          <div class="stat-label">{{ 'approvals.stats.pending' | translate }}</div>
        </div>
      </div>
    </app-base-card>
    <app-base-card [variant]="'elevated'">
      <div class="stat-card">
        <div class="stat-icon success">
          <span class="material-icons">check_circle</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ approvedCount() }}</div>
          <div class="stat-label">{{ 'approvals.stats.approved' | translate }}</div>
        </div>
      </div>
    </app-base-card>
    <app-base-card [variant]="'elevated'">
      <div class="stat-card">
        <div class="stat-icon error">
          <span class="material-icons">cancel</span>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ rejectedCount() }}</div>
          <div class="stat-label">{{ 'approvals.stats.rejected' | translate }}</div>
        </div>
      </div>
    </app-base-card>
  </div>

  <!-- Table -->
  <app-base-async-state
    [loading$]="loading$"
    [data$]="approvalsData$"
      [loadingMessage]="'approvals.loading' | translate"
      [emptyTitle]="'approvals.emptyTitle' | translate"
      [emptyDescription]="'approvals.emptyDescription' | translate"
    [onRetry]="onRetryLoad"
  >
    <app-base-table
      [data]="approvals()"
      [columns]="tableColumns"
      [actions]="tableActions"
      [config]="{ showHeader: true, showFooter: true, showPagination: true, showSearch: false, showActions: true, striped: true, hoverable: true }"
      [pageSize]="10"
      (rowClick)="onRowClick($event)"
    >
      <ng-template #cellTemplate let-row="row" let-column="column">
        <ng-container *ngIf="column.key === 'status'">
          <app-base-badge [text]="getStatusText(row.status)" [variant]="getStatusVariant(row.status)" size="small"></app-base-badge>
        </ng-container>
        <ng-container *ngIf="column.key === 'priority'">
          <app-base-badge [text]="row.priority" [variant]="getPriorityVariant(row.priority)" size="small"></app-base-badge>
        </ng-container>
        <ng-container *ngIf="column.key === 'currentStep'">
          <div class="progress-bar">
            <div class="progress-track">
              <div class="progress-fill" [style.width.%]="getProgress(row)"></div>
            </div>
            <span class="progress-text">{{ row.currentStep }}/{{ row.totalSteps }}</span>
          </div>
        </ng-container>
      </ng-template>
    </app-base-table>
  </app-base-async-state>
</app-base-private-page-container>

<!-- Approve Dialog -->
<app-base-prompt-dialog
  [isOpen]="!!showApproveDialog().approval"
  [config]="approveDialogConfig()"
  (confirm)="onApproveConfirm($event)"
  (cancelAction)="onApproveDialogClose()"
  (dialogClose)="onApproveDialogClose()"
></app-base-prompt-dialog>

<!-- Reject Dialog -->
<app-base-prompt-dialog
  [isOpen]="!!showRejectDialog().approval"
  [config]="rejectDialogConfig()"
  (confirm)="onRejectConfirm($event)"
  (cancelAction)="onRejectDialogClose()"
  (dialogClose)="onRejectDialogClose()"
></app-base-prompt-dialog>
