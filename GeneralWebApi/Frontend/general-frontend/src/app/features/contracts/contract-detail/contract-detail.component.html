<!-- Path: GeneralWebApi/Frontend/general-frontend/src/app/features/contracts/contract-detail/contract-detail.component.html -->
<app-base-modal
  [isOpen]="isOpen && contract !== null"
  [title]="getModalTitle()"
  [icon]="mode === 'edit' ? 'edit' : 'description'"
  [config]="{
    size: 'large',
    closable: true,
    backdrop: true,
    keyboard: true,
    animation: true,
    centered: true,
    scrollable: true
  }"
  (closeEvent)="onClose()"
  (backdropClick)="onBackdropClick()"
>
  <div class="contract-detail-content" *ngIf="contract">
    <div class="contract-form-container">
      <app-base-form
        [config]="formConfig"
        [formData]="formData"
        [loading]="loading()"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onFormCancel()"
      ></app-base-form>
    </div>

    <!-- Approval Information Section (only in view mode) -->
    <div class="approval-section" *ngIf="mode === 'view'">
      <div class="approval-header">
        <h3>{{ 'contracts.detail.approval.title' | translate }}</h3>
      </div>

      <!-- Loading state -->
      <div *ngIf="loadingApproval()" class="approval-loading">
        {{ 'contracts.detail.approval.loading' | translate }}
      </div>

      <!-- No approval -->
      <div *ngIf="!loadingApproval() && approvalSteps().length === 0" class="approval-empty">
        <p>{{ 'contracts.detail.approval.empty' | translate }}</p>
      </div>

      <!-- Approval steps -->
      <div *ngIf="!loadingApproval() && approvalSteps().length > 0" class="approval-steps">
        <div 
          *ngFor="let step of approvalSteps(); let i = index" 
          class="approval-step-item"
          [class.pending]="step.status === 'Pending'"
          [class.approved]="step.status === 'Approved'"
          [class.rejected]="step.status === 'Rejected'"
        >
          <div class="step-header">
            <div class="step-number">
              <span class="step-number-circle">{{ step.stepOrder }}</span>
              <div class="step-connector" *ngIf="i < approvalSteps().length - 1"></div>
            </div>
            <div class="step-content">
              <div class="step-title-row">
                <h4 class="step-name">{{ step.stepName }}</h4>
                <app-base-badge
                  [text]="step.status"
                  [variant]="getApprovalStatusVariant(step.status)"
                  size="small"
                ></app-base-badge>
              </div>
              
              <!-- Approver Information -->
              <div class="step-info">
                <div class="step-info-item" *ngIf="step.approverUserName">
                  <strong>{{ 'contracts.detail.approval.approver' | translate }}:</strong> {{ step.approverUserName }}
                  <span *ngIf="step.approverRole && !step.approverUserId" class="role-badge">({{ step.approverRole }})</span>
                </div>
                <div class="step-info-item" *ngIf="!step.approverUserName && step.approverRole">
                  <strong>{{ 'contracts.detail.approval.approverRole' | translate }}:</strong> {{ step.approverRole }}
                </div>
                <div class="step-info-item" *ngIf="step.status === 'Pending' && !step.approverUserName && !step.approverRole">
                  <em>{{ 'contracts.detail.approval.approverNotAssigned' | translate }}</em>
                </div>
              </div>

              <!-- Processed Information -->
              <div class="step-processed" *ngIf="step.status !== 'Pending'">
                <div class="step-info-item" *ngIf="step.processedBy">
                  <strong>{{ 'contracts.detail.approval.processedBy' | translate }}:</strong> {{ step.processedBy }}
                </div>
                <div class="step-info-item" *ngIf="step.processedAt">
                  <strong>{{ 'contracts.detail.approval.processedAt' | translate }}:</strong> {{ formatDate(step.processedAt) }}
                </div>
                <div class="step-info-item" *ngIf="step.comments">
                  <strong>{{ 'contracts.detail.approval.comments' | translate }}:</strong> {{ step.comments }}
                </div>
              </div>

              <!-- Pending Information -->
              <div class="step-pending" *ngIf="step.status === 'Pending'">
                <div class="step-info-item" *ngIf="step.dueDate">
                  <strong>{{ 'contracts.detail.approval.dueDate' | translate }}:</strong> {{ formatDate(step.dueDate) }}
                </div>
                <div class="step-info-item" *ngIf="step.comments">
                  <strong>{{ 'contracts.detail.approval.notes' | translate }}:</strong> {{ step.comments }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-base-modal>

