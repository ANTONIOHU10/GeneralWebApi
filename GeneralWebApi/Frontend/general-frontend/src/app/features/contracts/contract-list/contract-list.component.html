<!-- Path: GeneralWebApi/Frontend/general-frontend/src/app/features/contracts/contract-list/contract-list.component.html -->
<app-base-private-page-container
  title="Contract Management"
  subtitle="Manage and view all contracts in the system"
  icon="description"
  [showTabs]="true"
  [showSearch]="activeTab() === 'list'"
  [tabs]="tabs"
  [activeTabId]="activeTab()"
  (tabChange)="onTabChange($event)"
>
  <!-- Search and View Toggle in header - only shown when list tab is active -->
  <div *ngIf="activeTab() === 'list'" slot="search" class="header-actions">
    <app-base-search
      [config]="{
        placeholder: 'Search contracts...',
        debounceTime: 300,
        minLength: 1,
        showClearButton: true,
        showSearchButton: true,
      }"
      (searchChange)="onSearchChange($event)"
      inputId="contract-search"
      class="search-input"
    ></app-base-search>
    
    <!-- View Toggle Button -->
    <app-base-button
      [icon]="getViewModeIcon()"
      [text]="getViewModeLabel()"
      variant="outline"
      size="small"
      (buttonClick)="toggleViewMode()"
      [title]="'Switch to ' + (viewMode() === 'table' ? 'card' : 'table') + ' view'"
      customClass="view-toggle-btn"
    ></app-base-button>
  </div>

  <!-- Contract List Tab Content -->
  <div *ngIf="activeTab() === 'list'">
    <app-base-async-state
      [loading$]="loading$"
      [error$]="error$"
      [data$]="contracts$"
      loadingMessage="Loading contracts..."
      emptyTitle="No contracts found"
      emptyDescription="There are no contracts to display at the moment"
      emptyActionText="Add First Contract"
      [onRetry]="onRetryLoad"
      [onEmptyAction]="onEmptyActionClick"
    >
      <!-- Success content: Table View -->
      <app-base-table
        *ngIf="viewMode() === 'table'"
        [data]="(contractsArray$ | async) || []"
        [columns]="tableColumns"
        [actions]="tableActions"
        [config]="tableConfig"
        [pageSize]="20"
        (rowClick)="onTableRowClick($event)"
        (sortChange)="onTableSortChange($event)"
        (pageChange)="onTablePageChange($event)"
        class="contract-table"
      >
        <!-- Status Template -->
        <ng-template #statusTemplate let-contract="$implicit">
          <app-base-badge
            [text]="contract.status | titlecase"
            [variant]="getStatusVariant(contract.status)"
            size="small"
          ></app-base-badge>
        </ng-template>
      </app-base-table>

      <!-- Success content: Card View -->
      <div *ngIf="viewMode() === 'card'" class="contract-grid">
        <app-contract-card
          *ngFor="let contract of contracts$ | async"
          [contract]="contract"
          [showActions]="true"
          (edit)="onEditContract($event)"
          (delete)="onDeleteContract($event)"
          (view)="onViewContract($event)"
        >
        </app-contract-card>
      </div>
    </app-base-async-state>
  </div>

  <!-- Add Contract Tab Content -->
  <div *ngIf="activeTab() === 'add'">
    <app-add-contract (contractCreated)="onContractCreated()"></app-add-contract>
  </div>

  <!-- Submit for Approval Tab Content -->
  <div *ngIf="activeTab() === 'submit-approval'">
    <app-submit-contract-approval (approvalSubmitted)="onApprovalSubmitted()"></app-submit-contract-approval>
  </div>

  <!-- Search Contract Tab Content -->
  <div *ngIf="activeTab() === 'search'">
    <app-search-contract></app-search-contract>
  </div>
</app-base-private-page-container>

<!-- Contract Detail Modal -->
<app-contract-detail
  [contract]="selectedContractForDetail"
  [isOpen]="isDetailModalOpen"
  [mode]="detailMode"
  (closeEvent)="onCloseDetailModal()"
  (contractUpdated)="onContractUpdated($event)"
></app-contract-detail>

