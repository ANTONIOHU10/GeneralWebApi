<app-base-private-page-container
  [title]="'notifications.title' | translate"
  [subtitle]="unreadCount() > 0 ? ('notifications.unreadCount' | translate: {count: unreadCount()}) : ('notifications.allCaughtUp' | translate)"
  icon="notifications"
  [showTabs]="false"
  [showSearch]="false"
>
  <!-- Header Actions -->
  <div slot="actions" class="header-actions">
    @if (filteredNotifications().length > 0 && unreadCount() > 0) {
      <app-base-button
        [text]="'notifications.markAllRead' | translate"
        icon="done_all"
        variant="outline"
        size="small"
        [disabled]="loading$.value || unreadCount() === 0"
        (buttonClick)="markAllAsRead()"
      ></app-base-button>
    }
      <app-base-button
        [text]="loading$.value ? ('common.loading' | translate) : ('common.refresh' | translate)"
        icon="refresh"
      variant="ghost"
      size="small"
      [loading]="loading$.value"
      [disabled]="loading$.value"
      (buttonClick)="loadNotifications()"
    ></app-base-button>
  </div>

  <!-- Statistics Cards -->
  @if (stats()) {
    <div class="statistics-section">
      <app-base-card variant="elevated">
        <div class="stat-card">
          <div class="stat-icon primary">
            <span class="material-icons">notifications</span>
          </div>
          <div class="stat-content">
                  <div class="stat-value">{{ stats()!.total }}</div>
                  <div class="stat-label">{{ 'notifications.totalNotifications' | translate }}</div>
          </div>
        </div>
      </app-base-card>

      <app-base-card variant="elevated">
        <div class="stat-card">
          <div class="stat-icon warning">
            <span class="material-icons">mark_email_unread</span>
          </div>
          <div class="stat-content">
                  <div class="stat-value">{{ stats()!.unread }}</div>
                  <div class="stat-label">{{ 'notifications.unread' | translate }}</div>
          </div>
        </div>
      </app-base-card>

      <app-base-card variant="elevated">
        <div class="stat-card">
          <div class="stat-icon error">
            <span class="material-icons">priority_high</span>
          </div>
          <div class="stat-content">
                  <div class="stat-value">
                    {{ (stats()!.byPriority.urgent || 0) + (stats()!.byPriority.high || 0) }}
                  </div>
                  <div class="stat-label">{{ 'notifications.urgentHigh' | translate }}</div>
          </div>
        </div>
      </app-base-card>
    </div>
  }

  <!-- Filters Section -->
  <div class="filters-card">
    <div class="filters-header">
      <span class="material-icons">filter_list</span>
      <h3>{{ 'notifications.filters.title' | translate }}</h3>
    </div>
    <div class="filters-content">
      <div class="filter-groups">
        <div class="filter-group">
          <label for="type-filter">{{ 'notifications.filters.type' | translate }}</label>
          <app-base-select
            selectId="type-filter"
            [options]="typeFilterOptions"
            [ngModel]="getTypeFilterValue()"
            (ngModelChange)="onTypeFilterValueChange($event)"
            size="small"
          ></app-base-select>
        </div>

        <div class="filter-group">
          <label for="status-filter">{{ 'notifications.filters.status' | translate }}</label>
          <app-base-select
            selectId="status-filter"
            [options]="statusFilterOptions"
            [ngModel]="getStatusFilterValue()"
            (ngModelChange)="onStatusFilterValueChange($event)"
            size="small"
          ></app-base-select>
        </div>

        <div class="filter-group">
          <label for="priority-filter">{{ 'notifications.filters.priority' | translate }}</label>
          <app-base-select
            selectId="priority-filter"
            [options]="priorityFilterOptions"
            [ngModel]="getPriorityFilterValue()"
            (ngModelChange)="onPriorityFilterValueChange($event)"
            size="small"
          ></app-base-select>
        </div>

        @if (hasActiveFilters()) {
          <app-base-button
            [text]="'notifications.filters.clearFilters' | translate"
            icon="clear"
            variant="ghost"
            size="small"
            (buttonClick)="clearFilters()"
          ></app-base-button>
        }
      </div>
    </div>
  </div>

  <!-- Notifications List -->
  <div class="notifications-section">
    @if (loading$.value) {
      <app-base-loading
        [config]="{
          size: 'md',
          type: 'spinner',
                message: ('notifications.loading' | translate),
          centered: true,
          fullHeight: false
        }"
      ></app-base-loading>
    } @else if (error$.value) {
      <app-base-error
        [message]="error$.value"
        [showRetryButton]="true"
        (retry)="onRetryLoad()"
      ></app-base-error>
    } @else if (filteredNotifications().length === 0) {
      <app-base-empty
        [title]="hasActiveFilters() ? ('notifications.noMatchFilters' | translate) : ('notifications.noNotifications' | translate)"
        [description]="hasActiveFilters() ? ('notifications.noMatchFiltersDescription' | translate) : ('notifications.noNotificationsDescription' | translate)"
        [config]="getEmptyStateConfig()"
        (actionClick)="clearFilters()"
      ></app-base-empty>
    } @else {
      <div class="notification-list">
        @for (notification of filteredNotifications(); track notification.id) {
          <app-base-card
            [variant]="notification.status === 'unread' ? 'elevated' : 'outlined'"
            [customClass]="getNotificationCardClass(notification)"
          >
            <div 
              class="notification-item"
            >
              <!-- Icon with read status indicator -->
              <div class="notification-icon-wrapper">
                <div class="notification-icon" [class]="'icon-' + notification.type" [class.read]="notification.status === 'read'">
                  <span class="material-icons">{{ getTypeIcon(notification.type) }}</span>
                  @if (notification.status === 'read') {
                    <div class="read-overlay">
                      <span class="material-icons">check</span>
                    </div>
                  }
                </div>
                @if (notification.status === 'unread') {
                  <div class="unread-dot" title="Unread"></div>
                }
              </div>

              <!-- Content -->
              <div class="notification-content">
                <div class="notification-header">
                  <div class="title-section">
                    <h3 class="notification-title" [class.read]="notification.status === 'read'">
                      {{ notification.title }}
                    </h3>
                    <div class="notification-badges">
                      @if (notification.status === 'unread') {
                        <app-base-badge
                          [text]="'notifications.new' | translate"
                          variant="danger"
                          size="small"
                          shape="pill"
                          customClass="new-badge"
                        ></app-base-badge>
                      }
                      <app-base-badge
                        [text]="notification.priority"
                        [variant]="getPriorityVariant(notification.priority)"
                        size="small"
                        shape="pill"
                      ></app-base-badge>
                    </div>
                  </div>
                </div>

                <p class="notification-message">{{ notification.message }}</p>

                <div class="notification-footer">
                  <div class="notification-meta">
                    <span class="meta-item">
                      <span class="material-icons">schedule</span>
                      <span>{{ getTimeAgo(notification.createdAt) }}</span>
                    </span>
                    @if (notification.type) {
                      <span class="meta-item">
                        <span class="material-icons">category</span>
                        <span>{{ notification.type }}</span>
                      </span>
                    }
                  </div>

                  <div 
                    class="notification-actions"
                    tabindex="-1"
                    (click)="$event.stopPropagation()"
                  >
                    <app-base-button
                      [text]="notification.status === 'read' ? ('notifications.unread' | translate) : ('notifications.read' | translate)"
                      [icon]="notification.status === 'read' ? 'mark_email_unread' : 'done'"
                      [variant]="notification.status === 'read' ? 'outline' : 'outline'"
                      size="small"
                      [customClass]="notification.status === 'read' ? 'toggle-status-btn unread-state' : 'toggle-status-btn read-state'"
                      (buttonClick)="toggleReadStatus(notification, $event)"
                      [attr.title]="notification.status === 'read' ? ('notifications.unread' | translate) : ('notifications.read' | translate)"
                    ></app-base-button>
                    <app-base-button
                      icon="delete_outline"
                      variant="ghost"
                      size="small"
                      customClass="action-btn delete-btn"
                      (buttonClick)="deleteNotification(notification, $event)"
                      [attr.title]="'notifications.deleteNotification' | translate"
                    ></app-base-button>
                  </div>
                </div>
              </div>
            </div>
          </app-base-card>
        }
      </div>
    }
  </div>
</app-base-private-page-container>
